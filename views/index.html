<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Store</title>
</head>
<body>
  Welcome to the store.
  
  <form>
    <button id="pay-button">pay</button>
  </form>

  <script type="text/javascript" src="https://cdn.omise.co/omise.js"></script>
  <script>
    const isToken = (nonce) => nonce.startsWith("tokn_")

    const btn = document.getElementById("pay-button")
    OmiseCard.configure({
      publicKey: "pkey_test_5smbjs6xb6845qcglp3"
    })
    btn.addEventListener("click", (e) => {
      e.preventDefault()
      OmiseCard.open({
        amount: 10000,
        currency: "THB",
        defaultPaymentMethod: "credit_card",
        submitLabel: "pay for amount",
        locale: "th",
        onCreateTokenSuccess: nonce => {
          if (isToken(nonce)) {
            fetch("/pay", {
              method: "POST",
              headers: {"Content-type": "application/json"},
              body: JSON.stringify({
                amount: 10000,
                token: nonce
              }),
            })
              .then(res => res.json())
              .then(data => {
                console.log(data)
              })
            return
          }
          console.log(nonce)
        },
        onFormClosed: () => {
          console.log("close form")
        }
      })
    })
  </script>
</body>
</html>